<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Hand Tracking with Smartphone</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
</head>
<body style="margin:0;">

<!-- A-Frame scene -->
<a-scene>
  <a-box id="box" position="0 1.5 -3" color="red"></a-box>
  <a-sky color="#ECECEC"></a-sky>
</a-scene>

<!-- Hidden video for camera input -->
<video id="input_video" style="display:none;"></video>

<script>
  // Referensi box di A-Frame
  const boxEl = document.querySelector('#box');

  // MediaPipe Hands
  const hands = new Hands({
    locateFile: (file) => {
      return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
    }
  });
  hands.setOptions({
    maxNumHands: 1,
    modelComplexity: 1,
    minDetectionConfidence: 0.7,
    minTrackingConfidence: 0.7
  });

  hands.onResults(results => {
    if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
      const hand = results.multiHandLandmarks[0];
      //const wrist = hand[0]; // Titik pergelangan tangan
      const fingertip = hand[8]; // telunjuk

      // Ubah koordinat [0-1] jadi posisi di A-Frame
      const x = (fingertip.x - 0.5) * 4; // geser dan skala
      const y = (0.5 - fingertip.y) * 3 + 1.5;
      boxEl.setAttribute('position', `${x} ${y} -3`);
    

    }
  });

  // Akses kamera HP
  const videoElement = document.getElementById('input_video');
 // const camera = new Camera(videoElement, {
  //  onFrame: async () => {
   //   await hands.send({ image: videoElement });
   // },
  //  width: 640,
  //  height: 480
 // });
  // Cari kamera belakang
navigator.mediaDevices.getUserMedia({
  video: {
    facingMode: { exact: "environment" }, // pakai kamera belakang
    width: 640,
    height: 480
  }
}).then(stream => {
  videoElement.srcObject = stream;
  videoElement.play();

  // Loop frame manual
  async function processFrame() {
    await hands.send({ image: videoElement });
    requestAnimationFrame(processFrame);
  }
  processFrame();
});
  
  camera.start();
</script>

</body>
</html>


